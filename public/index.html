<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAME THAT TUNE! - Plex Music Quiz</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Space Mono', monospace;
        }
        
        .title-font {
            font-family: 'Righteous', cursive;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
        
        @keyframes slide-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes wave {
            0%, 100% { height: 20%; }
            50% { height: 80%; }
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-pulse-ring { animation: pulse-ring 2s ease-in-out infinite; }
        .animate-slide-up { animation: slide-up 0.5s ease-out forwards; }
        .animate-spin-slow { animation: spin-slow 20s linear infinite; }
        
        .loading-shimmer {
            position: relative;
            overflow: hidden;
        }
        
        .loading-shimmer::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        .choice-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }
        
        .choice-btn:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .choice-btn:active { transform: scale(0.98); }
        .wave-bar { animation: wave 0.8s ease-in-out infinite; }
        
        .vinyl-disc {
            background: radial-gradient(circle at center, #1a1a1a 30%, #000 30%, #000 35%, #1a1a1a 35%);
            position: relative;
        }
        
        .vinyl-disc::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20%;
            height: 20%;
            background: linear-gradient(45deg, #ff0080, #ff8c00);
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SVG Icons
        const Play = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Pause = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const RotateCcw = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const Trophy = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                <path d="M4 22h16"></path>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
            </svg>
        );

        const Music = ({ size = 24, className = "", style = {} }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={style}>
                <path d="M9 18V5l12-2v13"></path>
                <circle cx="6" cy="18" r="3"></circle>
                <circle cx="18" cy="16" r="3"></circle>
            </svg>
        );

        const Volume2 = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
        );

        const Clock = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const SkipForward = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 4 15 12 5 20 5 4"></polygon>
                <line x1="19" y1="5" x2="19" y2="19"></line>
            </svg>
        );

        const List = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
        );

        const MusicQuizGame = () => {
            const [gameState, setGameState] = useState('loading');
            const [currentRound, setCurrentRound] = useState(0);
            const [score, setScore] = useState(0);
            const [currentSong, setCurrentSong] = useState(null);
            const [choices, setChoices] = useState([]);
            const [allSongs, setAllSongs] = useState([]);
            const [isPlaying, setIsPlaying] = useState(false);
            const [difficulty, setDifficulty] = useState('medium');
            const [errorMessage, setErrorMessage] = useState('');
            const [timeRemaining, setTimeRemaining] = useState(null);
            const [loadingProgress, setLoadingProgress] = useState(0);
            const [customTimer, setCustomTimer] = useState(30);
            const [playerName, setPlayerName] = useState('');
            const [showLeaderboard, setShowLeaderboard] = useState(false);
            const [showNameInput, setShowNameInput] = useState(false);
            const [gameStartTime, setGameStartTime] = useState(null);
            const [totalGameTime, setTotalGameTime] = useState(0);
            const [leaderboardData, setLeaderboardData] = useState([]);
            
            const totalRounds = 10;
            const clipDuration = difficulty === 'easy' ? 15 : difficulty === 'medium' ? 10 : 5;
            
            const audioRef = useRef(new Audio());
            const timerInterval = useRef(null);
            const clipTimeout = useRef(null);
            const [loadingDots, setLoadingDots] = useState(0);

            useEffect(() => {
                loadSongs();
            }, []);

            // Animated dots during loading
            useEffect(() => {
                if (gameState === 'loading') {
                    const interval = setInterval(() => {
                        setLoadingDots(prev => (prev + 1) % 4);
                    }, 500);
                    return () => clearInterval(interval);
                }
            }, [gameState]);

            // Load leaderboard from server
            const fetchLeaderboard = async () => {
                try {
                    const response = await fetch('/api/leaderboard');
                    if (response.ok) {
                        const data = await response.json();
                        setLeaderboardData(data);
                    }
                } catch (error) {
                    console.error('Error loading leaderboard:', error);
                }
            };

            // Save score to server
            const saveScore = async (playerName, score, difficulty, customTimer, totalTime) => {
                try {
                    const response = await fetch('/api/leaderboard', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: playerName,
                            score: score,
                            difficulty: difficulty,
                            timer: customTimer,
                            totalTime: totalTime
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        setLeaderboardData(data.leaderboard);
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('Error saving score:', error);
                    return false;
                }
            };

            // Load leaderboard on start
            useEffect(() => {
                fetchLeaderboard();
            }, []);

            const loadSongs = async () => {
                try {
                    setLoadingProgress(10);
                    
                    const response = await fetch('/api/plex/music');
                    setLoadingProgress(50);
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    setLoadingProgress(80);
                    
                    if (data.tracks && data.tracks.length > 0) {
                        console.log(`Loaded ${data.tracks.length} songs from Plex`);
                        setAllSongs(data.tracks);
                        setLoadingProgress(100);
                        setTimeout(() => setGameState('start'), 500);
                    } else {
                        throw new Error('No songs found in Plex library');
                    }
                } catch (error) {
                    console.error('Failed to load Plex library:', error);
                    setErrorMessage(`Failed to connect to Plex: ${error.message}`);
                    setGameState('error');
                }
            };

            const generateChoices = (correctSong) => {
                const wrongSongs = allSongs.filter(s => s.id !== correctSong.id);
                const shuffled = wrongSongs.sort(() => Math.random() - 0.5);
                const selected = shuffled.slice(0, 3);
                const allChoices = [...selected, correctSong].sort(() => Math.random() - 0.5);
                return allChoices;
            };

            const startGame = () => {
                setGameState('playing');
                setCurrentRound(1);
                setScore(0);
                setShowLeaderboard(false);
                setGameStartTime(Date.now());
                loadNewSong();
            };

            const loadNewSong = () => {
                const randomSong = allSongs[Math.floor(Math.random() * allSongs.length)];
                setCurrentSong(randomSong);
                setChoices(generateChoices(randomSong));
                setIsPlaying(false);
                setTimeRemaining(customTimer);
                setGameState('playing');
            };

            const startTimer = () => {
                if (timerInterval.current) {
                    clearInterval(timerInterval.current);
                }
                
                timerInterval.current = setInterval(() => {
                    setTimeRemaining(prev => {
                        if (prev <= 1) {
                            clearInterval(timerInterval.current);
                            handleTimeout();
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
            };

            const handleTimeout = () => {
                stopClip();
                setGameState('wrong');
                
                setTimeout(() => {
                    if (currentRound >= totalRounds) {
                        const endTime = Date.now();
                        const totalTime = (endTime - gameStartTime) / 1000; // Convert to seconds
                        setTotalGameTime(totalTime);
                        setShowNameInput(true);
                        setGameState('ended');
                    } else {
                        setCurrentRound(currentRound + 1);
                        loadNewSong();
                    }
                }, 2500);
            };

            const playClip = () => {
                if (!currentSong?.audioPath) return;

                const audio = audioRef.current;
                
                // Clear any existing timeout
                if (clipTimeout.current) {
                    clearTimeout(clipTimeout.current);
                    clipTimeout.current = null;
                }
                
                audio.src = `/api/plex/audio${currentSong.audioPath}`;
                
                audio.addEventListener('loadedmetadata', () => {
                    const maxStart = Math.max(0, audio.duration - clipDuration - 5);
                    const randomStart = Math.random() * maxStart;
                    audio.currentTime = randomStart;
                    audio.play();
                }, { once: true });

                // Start timer and clip timeout when audio actually starts playing
                audio.addEventListener('playing', () => {
                    setIsPlaying(true);
                    startTimer();
                    
                    // Stop after exact clip duration
                    clipTimeout.current = setTimeout(() => {
                        audio.pause();
                        setIsPlaying(false);
                    }, clipDuration * 1000);
                }, { once: true });

                audio.load();
            };

            const stopClip = () => {
                // Clear clip timeout
                if (clipTimeout.current) {
                    clearTimeout(clipTimeout.current);
                    clipTimeout.current = null;
                }
                
                audioRef.current.pause();
                setIsPlaying(false);
            };

            const handleAnswer = (song) => {
                stopClip();
                if (timerInterval.current) {
                    clearInterval(timerInterval.current);
                }
                
                if (song.id === currentSong.id) {
                    setScore(score + 1);
                    setGameState('correct');
                } else {
                    setGameState('wrong');
                }

                setTimeout(() => {
                    if (currentRound >= totalRounds) {
                        const endTime = Date.now();
                        const totalTime = (endTime - gameStartTime) / 1000; // Convert to seconds
                        setTotalGameTime(totalTime);
                        setShowNameInput(true);
                        setGameState('ended');
                    } else {
                        setCurrentRound(currentRound + 1);
                        loadNewSong();
                    }
                }, 2500);
            };

            const handleSkip = () => {
                stopClip();
                if (timerInterval.current) {
                    clearInterval(timerInterval.current);
                }
                
                setGameState('wrong');
                
                setTimeout(() => {
                    if (currentRound >= totalRounds) {
                        const endTime = Date.now();
                        const totalTime = (endTime - gameStartTime) / 1000; // Convert to seconds
                        setTotalGameTime(totalTime);
                        setShowNameInput(true);
                        setGameState('ended');
                    } else {
                        setCurrentRound(currentRound + 1);
                        loadNewSong();
                    }
                }, 2500);
            };

            const handleSaveScore = async () => {
                if (playerName.trim()) {
                    const success = await saveScore(playerName.trim(), score, difficulty, customTimer, totalGameTime);
                    if (success) {
                        setShowNameInput(false);
                        setShowLeaderboard(true);
                    }
                }
            };

            const restartGame = () => {
                stopClip();
                if (timerInterval.current) {
                    clearInterval(timerInterval.current);
                }
                setGameState('start');
                setCurrentRound(0);
                setScore(0);
                setPlayerName('');
                setShowNameInput(false);
                setShowLeaderboard(false);
            };

            const applyDifficultyPreset = (level) => {
                setDifficulty(level);
                if (level === 'easy') setCustomTimer(45);
                else if (level === 'medium') setCustomTimer(30);
                else setCustomTimer(20);
            };

            useEffect(() => {
                return () => {
                    audioRef.current.pause();
                    if (timerInterval.current) {
                        clearInterval(timerInterval.current);
                    }
                    if (clipTimeout.current) {
                        clearTimeout(clipTimeout.current);
                    }
                };
            }, []);

            // Loading screen
            if (gameState === 'loading') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex items-center justify-center">
                        <div className="text-center">
                            <div className="vinyl-disc w-32 h-32 rounded-full mx-auto mb-6 animate-spin-slow"></div>
                            <p className="text-2xl text-white title-font mb-6">
                                Loading your music library{'.'.repeat(loadingDots)}
                            </p>
                            
                            <div className="w-80 mx-auto">
                                <div className="bg-white bg-opacity-20 h-4 rounded-full overflow-hidden mb-3 loading-shimmer">
                                    <div 
                                        className="bg-gradient-to-r from-pink-500 via-purple-500 to-orange-500 h-full transition-all duration-500 ease-out rounded-full relative"
                                        style={{ width: `${loadingProgress}%` }}
                                    >
                                        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-pulse"></div>
                                    </div>
                                </div>
                                <p className="text-white text-opacity-70 text-sm animate-pulse">{loadingProgress}%</p>
                            </div>
                            
                            {loadingProgress === 10 && (
                                <p className="text-pink-200 text-sm mt-4 animate-pulse">Connecting to Plex server...</p>
                            )}
                            {loadingProgress === 50 && (
                                <p className="text-pink-200 text-sm mt-4 animate-pulse">Loading track library...</p>
                            )}
                            {loadingProgress === 80 && (
                                <p className="text-pink-200 text-sm mt-4 animate-pulse">Almost there...</p>
                            )}
                        </div>
                    </div>
                );
            }

            // Error screen
            if (gameState === 'error') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex items-center justify-center p-4">
                        <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-3xl p-12 max-w-2xl text-center">
                            <div className="text-6xl mb-6">‚ö†Ô∏è</div>
                            <h2 className="title-font text-4xl text-white mb-4">Connection Error</h2>
                            <p className="text-xl text-pink-200 mb-8">{errorMessage}</p>
                            <div className="text-left text-white text-opacity-80 bg-black bg-opacity-30 rounded-xl p-6 mb-6">
                                <p className="mb-2"><strong>Troubleshooting:</strong></p>
                                <ul className="list-disc list-inside space-y-1 text-sm">
                                    <li>Make sure your Plex server is running</li>
                                    <li>Check that PLEX_URL and PLEX_TOKEN are set correctly</li>
                                    <li>Verify your Plex server is accessible at the configured URL</li>
                                    <li>Ensure you have at least one music library in Plex</li>
                                </ul>
                            </div>
                            <button
                                onClick={loadSongs}
                                className="bg-white text-purple-600 px-8 py-4 rounded-full font-bold text-lg hover:scale-110 transition-transform"
                            >
                                Try Again
                            </button>
                        </div>
                    </div>
                );
            }

            // Leaderboard view
            if (showLeaderboard && gameState !== 'playing') {
                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                };
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex items-center justify-center p-4">
                        <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-3xl p-8 max-w-3xl w-full">
                            <div className="flex items-center justify-center gap-4 mb-8">
                                <Trophy className="text-yellow-400 animate-float" size={64} />
                                <h2 className="title-font text-5xl text-white">LEADERBOARD</h2>
                            </div>
                            
                            {leaderboardData.length === 0 ? (
                                <p className="text-center text-pink-200 text-xl mb-8">No scores yet! Be the first to play!</p>
                            ) : (
                                <div className="space-y-3 mb-8">
                                    {leaderboardData.map((entry, index) => (
                                        <div key={index} className="bg-white bg-opacity-20 rounded-xl p-4 flex items-center gap-4">
                                            <div className={`text-3xl font-bold title-font w-12 text-center ${
                                                index === 0 ? 'text-yellow-400' : 
                                                index === 1 ? 'text-gray-300' : 
                                                index === 2 ? 'text-orange-400' : 'text-white'
                                            }`}>
                                                #{index + 1}
                                            </div>
                                            <div className="flex-1">
                                                <div className="text-white font-bold text-xl">{entry.name}</div>
                                                <div className="text-pink-200 text-sm">
                                                    {entry.difficulty} ‚Ä¢ {entry.timer}s timer ‚Ä¢ Time: {formatTime(entry.totalTime)}
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-3xl font-bold text-white title-font">{entry.score}/10</div>
                                                <div className="text-pink-200 text-xs">{new Date(entry.date).toLocaleDateString()}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                            
                            <button
                                onClick={() => setShowLeaderboard(false)}
                                className="bg-white text-purple-600 px-8 py-4 rounded-full font-bold text-lg hover:scale-110 transition-transform w-full"
                            >
                                Back to Menu
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex items-center justify-center p-4 font-sans">
                    {/* Floating music notes background */}
                    <div className="absolute inset-0 overflow-hidden pointer-events-none opacity-10">
                        {[...Array(20)].map((_, i) => (
                            <Music
                                key={i}
                                className="absolute text-white animate-float"
                                style={{
                                    left: `${Math.random() * 100}%`,
                                    top: `${Math.random() * 100}%`,
                                    fontSize: `${Math.random() * 30 + 20}px`,
                                    animationDelay: `${Math.random() * 5}s`,
                                }}
                            />
                        ))}
                    </div>

                    <div className="relative z-10 w-full max-w-4xl">
                        {/* Start Screen */}
                        {gameState === 'start' && (
                            <div className="text-center animate-slide-up">
                                <div className="vinyl-disc w-48 h-48 rounded-full mx-auto mb-8 animate-spin-slow"></div>
                                <h1 className="title-font text-7xl font-bold text-white mb-4 drop-shadow-2xl">
                                    NAME THAT TUNE!
                                </h1>
                                <p className="text-2xl text-pink-200 mb-2">Plex Music Challenge</p>
                                <p className="text-lg text-pink-300 mb-12">Powered by your Plex library ‚Ä¢ {allSongs.length} songs loaded</p>
                                
                                <div className="bg-white bg-opacity-10 backdrop-blur-lg rounded-3xl p-8 mb-6 border-4 border-white border-opacity-20">
                                    <h3 className="title-font text-2xl text-white mb-6">Choose Difficulty</h3>
                                    <div className="flex gap-4 justify-center flex-wrap mb-6">
                                        {['easy', 'medium', 'hard'].map((level) => (
                                            <button
                                                key={level}
                                                onClick={() => applyDifficultyPreset(level)}
                                                className={`px-8 py-4 rounded-xl font-bold text-lg uppercase tracking-wider transition-all ${
                                                    difficulty === level
                                                        ? 'bg-gradient-to-r from-pink-500 to-orange-500 text-white scale-110 shadow-2xl'
                                                        : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                                                }`}
                                            >
                                                {level}
                                                <div className="text-xs mt-1 opacity-80">
                                                    {level === 'easy' ? '15s clips ‚Ä¢ 45s' : level === 'medium' ? '10s clips ‚Ä¢ 30s' : '5s clips ‚Ä¢ 20s'}
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                    
                                    <div className="border-t border-white border-opacity-20 pt-6">
                                        <h4 className="text-white text-lg mb-4">Custom Timer: <span className="text-pink-300 font-bold">{customTimer}s</span></h4>
                                        <input
                                            type="range"
                                            min="10"
                                            max="60"
                                            value={customTimer}
                                            onChange={(e) => setCustomTimer(parseInt(e.target.value))}
                                            className="w-full h-2 bg-white bg-opacity-20 rounded-lg appearance-none cursor-pointer"
                                        />
                                        <div className="flex justify-between text-white text-opacity-60 text-sm mt-2">
                                            <span>10s</span>
                                            <span>60s</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-4 justify-center mb-8">
                                    <button
                                        onClick={startGame}
                                        className="bg-gradient-to-r from-pink-500 via-purple-500 to-orange-500 text-white px-16 py-6 rounded-full text-2xl font-bold hover:scale-110 transition-transform shadow-2xl animate-pulse-ring"
                                    >
                                        START GAME
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowLeaderboard(true)}
                                        className="bg-white bg-opacity-20 text-white px-12 py-6 rounded-full text-2xl font-bold hover:scale-110 transition-transform shadow-2xl flex items-center gap-3"
                                    >
                                        <List size={28} /> LEADERBOARD
                                    </button>
                                </div>

                                <div className="text-white text-opacity-70 text-sm">
                                    <p className="mb-2">üéµ Listen to clips from your library and guess the song! üéµ</p>
                                    <p>{totalRounds} rounds ‚Ä¢ Timer starts when you play ‚Ä¢ Score points for correct answers</p>
                                </div>
                            </div>
                        )}

                        {/* Game Screen */}
                        {gameState === 'playing' && currentSong && (
                            <div className="animate-slide-up">
                                <div className="flex justify-between items-center mb-8 bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 border-2 border-white border-opacity-20">
                                    <div className="flex items-center gap-4">
                                        <Trophy className="text-yellow-400" size={32} />
                                        <div>
                                            <div className="text-5xl font-bold text-white title-font">{score}</div>
                                            <div className="text-sm text-pink-200">points</div>
                                        </div>
                                    </div>
                                    <div className="text-center">
                                        <div className={`text-6xl font-bold title-font ${
                                            timeRemaining === null ? 'text-gray-400' :
                                            timeRemaining <= 5 ? 'text-red-400 animate-pulse' : 
                                            timeRemaining <= 10 ? 'text-yellow-400' : 'text-white'
                                        }`}>
                                            {timeRemaining === null ? '--' : timeRemaining}
                                        </div>
                                        <div className="text-sm text-pink-200 flex items-center justify-center gap-1">
                                            <Clock size={16} /> {timeRemaining === null ? 'Press Play' : 'seconds left'}
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-3xl font-bold text-white title-font">
                                            Round {currentRound}/{totalRounds}
                                        </div>
                                        <div className="text-sm text-pink-200 uppercase tracking-wide">{difficulty} mode</div>
                                    </div>
                                </div>

                                <div className="bg-gradient-to-br from-purple-600 to-pink-600 rounded-3xl p-8 mb-8 shadow-2xl border-4 border-white border-opacity-20">
                                    <div className="flex flex-col items-center">
                                        <div className="w-48 h-48 bg-black bg-opacity-40 rounded-full flex items-center justify-center mb-6 relative overflow-hidden">
                                            {isPlaying ? (
                                                <div className="flex gap-2 items-end h-20">
                                                    {[...Array(7)].map((_, i) => (
                                                        <div
                                                            key={i}
                                                            className="w-3 bg-gradient-to-t from-pink-400 to-orange-400 rounded-full wave-bar"
                                                            style={{ animationDelay: `${i * 0.1}s` }}
                                                        ></div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <Volume2 className="text-white opacity-40" size={64} />
                                            )}
                                        </div>

                                        <div className="flex gap-4">
                                            <button
                                                onClick={isPlaying ? stopClip : playClip}
                                                className="bg-white text-purple-600 px-12 py-5 rounded-full font-bold text-xl flex items-center gap-3 hover:scale-110 transition-transform shadow-xl"
                                            >
                                                {isPlaying ? (
                                                    <>
                                                        <Pause size={28} /> PAUSE
                                                    </>
                                                ) : (
                                                    <>
                                                        <Play size={28} /> PLAY CLIP
                                                    </>
                                                )}
                                            </button>

                                            <button
                                                onClick={handleSkip}
                                                className="bg-red-500 text-white px-8 py-5 rounded-full font-bold text-xl flex items-center gap-3 hover:scale-110 transition-transform shadow-xl"
                                            >
                                                <SkipForward size={28} /> SKIP
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {choices.map((song, index) => (
                                        <button
                                            key={song.id}
                                            onClick={() => handleAnswer(song)}
                                            className="choice-btn bg-white bg-opacity-90 backdrop-blur-sm rounded-2xl p-6 text-left hover:bg-opacity-100 border-4 border-transparent hover:border-pink-400 animate-slide-up"
                                            style={{ animationDelay: `${index * 0.1}s` }}
                                        >
                                            <div className="flex items-start gap-4">
                                                <div className="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center text-white font-bold text-xl title-font flex-shrink-0">
                                                    {String.fromCharCode(65 + index)}
                                                </div>
                                                <div className="flex-1">
                                                    <div className="font-bold text-xl text-gray-800 mb-1">{song.title}</div>
                                                    <div className="text-gray-600">{song.artist}</div>
                                                    <div className="text-sm text-gray-500 mt-1">{song.album}{song.year ? ` ‚Ä¢ ${song.year}` : ''}</div>
                                                </div>
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Correct Answer */}
                        {gameState === 'correct' && currentSong && (
                            <div className="text-center animate-slide-up">
                                <div className="bg-gradient-to-br from-green-400 to-emerald-600 rounded-3xl p-12 shadow-2xl border-4 border-white border-opacity-30">
                                    <div className="text-8xl mb-6 animate-float">üéâ</div>
                                    <h2 className="title-font text-6xl font-bold text-white mb-4">CORRECT!</h2>
                                    <div className="bg-white bg-opacity-20 rounded-2xl p-6 mt-6">
                                        <div className="text-3xl font-bold text-white mb-2">{currentSong.title}</div>
                                        <div className="text-xl text-green-100">{currentSong.artist}</div>
                                        <div className="text-green-200 mt-2">{currentSong.album}{currentSong.year ? ` ‚Ä¢ ${currentSong.year}` : ''}</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Wrong Answer */}
                        {gameState === 'wrong' && currentSong && (
                            <div className="text-center animate-slide-up">
                                <div className="bg-gradient-to-br from-red-500 to-pink-600 rounded-3xl p-12 shadow-2xl border-4 border-white border-opacity-30">
                                    <div className="text-8xl mb-6">üò¢</div>
                                    <h2 className="title-font text-6xl font-bold text-white mb-4">NOT QUITE!</h2>
                                    <div className="bg-white bg-opacity-20 rounded-2xl p-6 mt-6">
                                        <p className="text-xl text-red-100 mb-4">The correct answer was:</p>
                                        <div className="text-3xl font-bold text-white mb-2">{currentSong.title}</div>
                                        <div className="text-xl text-red-100">{currentSong.artist}</div>
                                        <div className="text-red-200 mt-2">{currentSong.album}{currentSong.year ? ` ‚Ä¢ ${currentSong.year}` : ''}</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Game Over - Name Input */}
                        {gameState === 'ended' && showNameInput && (
                            <div className="text-center animate-slide-up">
                                <div className="bg-gradient-to-br from-purple-600 to-pink-600 rounded-3xl p-12 shadow-2xl border-4 border-white border-opacity-30">
                                    <Trophy className="mx-auto text-yellow-400 mb-6 animate-float" size={120} />
                                    <h2 className="title-font text-6xl font-bold text-white mb-6">GAME OVER!</h2>
                                    <div className="text-8xl font-bold text-white mb-8 title-font">{score}/{totalRounds}</div>
                                    
                                    <div className="bg-white bg-opacity-20 rounded-2xl p-6 mb-6">
                                        <p className="text-white text-xl mb-4">Enter your name for the leaderboard:</p>
                                        <input
                                            type="text"
                                            value={playerName}
                                            onChange={(e) => setPlayerName(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleSaveScore()}
                                            placeholder="Your name..."
                                            maxLength={20}
                                            className="w-full px-6 py-4 rounded-xl text-2xl text-center font-bold bg-white text-purple-600 placeholder-purple-300 focus:outline-none focus:ring-4 focus:ring-pink-400"
                                        />
                                    </div>
                                    
                                    <div className="flex gap-4 justify-center">
                                        <button
                                            onClick={handleSaveScore}
                                            disabled={!playerName.trim()}
                                            className="bg-white text-purple-600 px-12 py-6 rounded-full font-bold text-2xl hover:scale-110 transition-transform shadow-xl disabled:opacity-50 disabled:hover:scale-100"
                                        >
                                            SAVE SCORE
                                        </button>
                                        
                                        <button
                                            onClick={restartGame}
                                            className="bg-white bg-opacity-20 text-white px-12 py-6 rounded-full font-bold text-2xl hover:scale-110 transition-transform shadow-xl flex items-center gap-3"
                                        >
                                            <RotateCcw size={32} /> SKIP
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Game Over - After Save */}
                        {gameState === 'ended' && !showNameInput && !showLeaderboard && (
                            <div className="text-center animate-slide-up">
                                <div className="bg-gradient-to-br from-purple-600 to-pink-600 rounded-3xl p-12 shadow-2xl border-4 border-white border-opacity-30">
                                    <Trophy className="mx-auto text-yellow-400 mb-6 animate-float" size={120} />
                                    <h2 className="title-font text-6xl font-bold text-white mb-6">GAME OVER!</h2>
                                    <div className="text-8xl font-bold text-white mb-4 title-font">{score}/{totalRounds}</div>
                                    <p className="text-3xl text-pink-200 mb-8">
                                        {score === totalRounds
                                            ? "PERFECT SCORE! üéµ"
                                            : score >= totalRounds * 0.7
                                            ? "Amazing! You know your music! üé∏"
                                            : score >= totalRounds * 0.5
                                            ? "Good job! Keep practicing! üéπ"
                                            : "Nice try! Play again? üé§"}
                                    </p>
                                    <div className="flex gap-4 justify-center">
                                        <button
                                            onClick={restartGame}
                                            className="bg-white text-purple-600 px-12 py-6 rounded-full font-bold text-2xl hover:scale-110 transition-transform shadow-xl flex items-center gap-3"
                                        >
                                            <RotateCcw size={32} /> PLAY AGAIN
                                        </button>
                                        
                                        <button
                                            onClick={() => setShowLeaderboard(true)}
                                            className="bg-white bg-opacity-20 text-white px-12 py-6 rounded-full font-bold text-2xl hover:scale-110 transition-transform shadow-xl flex items-center gap-3"
                                        >
                                            <List size={32} /> LEADERBOARD
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MusicQuizGame />);
    </script>
</body>
</html>